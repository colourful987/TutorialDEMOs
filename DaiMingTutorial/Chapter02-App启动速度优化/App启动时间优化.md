# 02 | App 启动速度怎么做优化和监控

App 启动分为冷启动和热启动：

* 冷启动： App点击启动前，并未创建执行进程，因此系统会新创建一个进程分配给它执行，此时可认为应用程序是从无到有的一个过程，因此需要走一遍完整的加载过程：
  * 包括加载可执行文件、加载链接动态库、加载包含所有类信息的Image(aka，类信息，元类信息等)，调用`+(void)load`方法以及C++全局变量等；
  * `didFinishLaunchingWithOptions` 方法中走一圈，通常这个阶段我们会读取配置文件，注册推送，以及一些初始化服务等操作；
  * **Note:** `didFinishLaunchingWithOptions` 中我们还需要指定 window 的rootViewController，也就是我们的首页控制器，所以这里不能忽视首屏的加载时间，通常此处也是优化点之一；
* 热启动：App 冷启动后退后台，未被系统杀掉进程的前提下重新进入，通常来说启动会很快，毕竟进程还在，堆栈信息、数据都保留着，只需要恢复下即可。



结合DM的文章以及我的优化思路：

**main()函数之前**

* 减少动态库加载。每个库本身都有依赖关系，苹果公司建议使用更少的动态库，并且建议在使用动态库的数量较多时，尽量将多个动态库进行合并。数量上，苹果公司最多可以支持6 个非系统动态库合并为一个。
* 减少不适用的类或者方法，其实就是减少 Image 镜像，这个也可认为是一个配置文件，积少成多，别小看这个；
* `+load` 方法替换成 `+initialize` ，或者方法内容延后加载；
* 控制 C++ 全局变量的数量

**main()函数之后**：

* 理清哪些是必要的初始化功能，哪些是可以延后到首屏渲染之后；
* 某些配置读取操作是必要的，因为配置文件中某几个配置项必须优先加载，但是换个思路，是否可以先使用默认配置，子线程读取配置后替换掉默认配置？
* 首页UI渲染优化，图片资源的加载
* 卡主线程的耗时操作，这个自然不用说



### 如何做一个方法级别启动耗时检查工具来辅助分析和监控

思路是 hook `objc_msgSend`，未看，待学习，ps：之前看的 `objc_msgSend` 汇编源码都忘光了，庆幸的是留有记录，另外fishhook我记得只能hook动态库的吧。。。。。











































